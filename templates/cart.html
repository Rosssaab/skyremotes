{% extends "base.html" %}

{% block title %}Shopping Cart{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Shopping Cart</h1>
    
    <div id="cart-empty" class="alert alert-info d-none">
        Your cart is empty. <a href="{{ url_for('buy') }}">Continue shopping</a>
    </div>
    
    <div id="cart-content" class="d-none">
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="alert alert-info">
                    <h5 class="mb-2">Bulk Order Discounts!</h5>
                    <p class="mb-0">Adjust the quantity to apply discounts automatically:</p>
                    <ul class="mb-0">
                        <li>2 remotes - 10% off</li>
                        <li>3 remotes - 15% off</li>
                        <li>4+ remotes - 20% off</li>
                    </ul>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="table-responsive mb-4">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="cart-items">
                            <tr>
                                <td>Sky Remote Control</td>
                                <td>£<span class="unit-price">29.95</span></td>
                                <td>
                                    <input type="number" class="form-control quantity-input" value="1" min="1" style="width: 70px">
                                </td>
                                <td>£<span class="row-total">29.95</span></td>
                                <td>
                                    <button class="btn btn-danger btn-sm remove-item" onclick="removeFromCart()">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="row">
                    <div class="col-md-6 offset-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h3>Order Summary</h3>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Subtotal:</span>
                                    <span id="subtotal">£0.00</span>
                                </div>
                                <div id="discount-row" class="d-flex justify-content-between mb-2 text-success d-none">
                                    <span id="discount-text"></span>
                                    <span id="discount-amount"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-3">
                                    <span>Shipping:</span>
                                    <span>FREE</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between mb-3">
                                    <strong>Total:</strong>
                                    <strong id="total">£0.00</strong>
                                </div>
                                <button class="btn btn-primary btn-lg w-100" onclick="proceedToCheckout()">
                                    Proceed to Checkout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateCart() {
    const cart = JSON.parse(localStorage.getItem('cart')) || { items: [], total: 0 };
    const cartContent = document.getElementById('cart-content');
    const cartEmpty = document.getElementById('cart-empty');
    const cartCount = document.getElementById('cart-count');
    
    if (cart.items.length === 0) {
        cartContent.classList.add('d-none');
        cartEmpty.classList.remove('d-none');
        cartCount.textContent = '0';
        return;
    }
    
    cartContent.classList.remove('d-none');
    cartEmpty.classList.add('d-none');
    
    const quantity = cart.items[0].quantity;
    const unitPrice = 29.95;
    const subtotal = quantity * unitPrice;
    
    // Update quantity input and row total (should match subtotal)
    const quantityInput = document.querySelector('.quantity-input');
    const rowTotalSpan = document.querySelector('.row-total');
    if (quantityInput) quantityInput.value = quantity;
    if (rowTotalSpan) rowTotalSpan.textContent = subtotal.toFixed(2);
    
    // Update cart count
    cartCount.textContent = quantity;
    
    // Calculate discount
    let discount = 0;
    let discountText = '';
    if (quantity >= 4) {
        discount = 0.20;
        discountText = '20% bulk discount applied!';
    } else if (quantity >= 3) {
        discount = 0.15;
        discountText = '15% bulk discount applied!';
    } else if (quantity >= 2) {
        discount = 0.10;
        discountText = '10% bulk discount applied!';
    }
    
    const discountAmount = subtotal * discount;
    const total = subtotal - discountAmount;
    
    // Update order summary
    document.getElementById('subtotal').textContent = `£${subtotal.toFixed(2)}`;
    document.getElementById('total').textContent = `£${total.toFixed(2)}`;
    
    // Show/hide discount
    const discountRow = document.getElementById('discount-row');
    if (discount > 0) {
        discountRow.classList.remove('d-none');
        document.getElementById('discount-text').textContent = discountText;
        document.getElementById('discount-amount').textContent = `-£${discountAmount.toFixed(2)}`;
    } else {
        discountRow.classList.add('d-none');
    }
}

function removeFromCart() {
    localStorage.removeItem('cart');
    updateCart();
}

function proceedToCheckout() {
    alert('Checkout functionality coming soon!');
}

// Add event listener for quantity changes
document.querySelector('.quantity-input').addEventListener('change', function(e) {
    const cart = JSON.parse(localStorage.getItem('cart')) || { items: [], total: 0 };
    if (cart.items.length > 0) {
        cart.items[0].quantity = parseInt(e.target.value);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCart();
    }
});

// Initial cart update
updateCart();
</script>
{% endblock %} 